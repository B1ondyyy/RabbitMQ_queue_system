# Система Очереди Сообщений с RabbitMQ

## Описание

Этот проект представляет собой систему очереди сообщений с использованием RabbitMQ, предназначенную для распределенных систем и микросервисов. Система состоит из двух консольных приложений:

1. **producer**: Принимает HTTP(S) URL в качестве аргумента командной строки, извлекает все внутренние ссылки (в пределах того же домена) из HTML-контента и отправляет каждую ссылку в очередь RabbitMQ по одной.

2. **consumer**: Постоянно слушает очередь RabbitMQ, обрабатывает каждую ссылку, извлекает её внутренние ссылки и при необходимости добавляет новые ссылки обратно в очередь. Потребитель завершает работу, если очередь остаётся пустой в течение указанного таймаута.

Дополнительно предоставлен утилитный скрипт `clear_queue.py` для очистки всех сообщений из очереди RabbitMQ.

[![Rabbit-MQ.png](https://i.postimg.cc/MGhC05KM/Rabbit-MQ.png)](https://postimg.cc/WDwYTMZT)

## Особенности

- **Распределённое Общение**: Обеспечивает обмен данными между различными компонентами распределённой системы через RabbitMQ.
- **Извлечение Ссылок**: Извлекает внутренние ссылки из предоставленных URL, обрабатывая как абсолютные, так и относительные ссылки.
- **Логирование**: Записывает прогресс обработки как в консоль, так и в лог-файл (`app.log`).
- **Конфигурация**: Параметры подключения к RabbitMQ настраиваются через переменные окружения.
- **Обработка Таймаута**: Потребитель завершает работу после периода бездействия.

## Установка

### Требования

- **Python**: Версия 3.8 или выше
- **Docker**: Для запуска RabbitMQ в контейнере
- **Git**: Для клонирования репозитория

### Шаги Установки

1. **Клонирование Репозитория**

   ```bash
   git clone https://github.com/B1ondyyy/RabbitMQ_queue_system.git
   cd RabbitMQ_queue_system
   ```
   
2. Создание и Активация Виртуального Окружения (Опционально, но Рекомендуется)
   ```
   python -m venv .venv
   source .venv/bin/activate  # На Windows: .venv\Scripts\activate
   ```
   
3. Установка Зависимостей
   ```
   pip install -r requirements.txt
   ```
   
4. Запуск RabbitMQ через Docker
   ```
   docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management
   ```

   (Интерфейс управления доступен будет по адресу http://localhost:15672)

5. Настройка Пользователей и Прав Доступа в RabbitMQ
   Имя пользователя: guest
   Пароль: guest

   Требуется создать пользователей в разделе Admin → Users → Add a new user:
   - producer, пароль pro1111
   - consumer, пароль 1111

   Назначение прав доступа:
   Для обоих пользователей назначьте права доступа к виртуальному хосту /:

    - Configure: links_queue
    - Write: links_queue
    - Read: links_queue

## Запуск 

### Запуск Consumer

Consumer постоянно слушает очередь и обрабатывает входящие сообщения.

1. Настройка переменных окружения

Файл consumer.env содержит правильные параметры.

2. Запуск consumer.py:
   ```
   python consumer.py
   ```
  Вывод:
   ```
   2024-12-15 04:58:08,063 - INFO - Created channel=1
   2024-12-15 04:58:08,074 - INFO - Waiting for messages...
   ```

### Запуск Producer

Производитель принимает URL, извлекает внутренние ссылки и отправляет их в очередь.

1. Настройка переменных окружения

Файл producer.env содержит правильные параметры.

2. Запуск producer.py с указанным URL с **внутренними** ссылками (например, https://www.python.org)

   ```
   python producer.py https://www.python.org
   ```

Пример вывода:

   ```
   2024-12-15 04:58:33,493 - INFO - Processing URL: https://www.python.org
   2024-12-15 04:58:34,253 - INFO - Found 10 internal links on     https://www.python.org.
   2024-12-15 04:58:34,253 - INFO - 8 new links to send to the queue.
   2024-12-15 04:58:34,253 - INFO - Sending link:     https://www.python.org/about/
   ...
   2024-12-15 04:58:34,253 - INFO - Processed 8 new links.

   ```

Тем временем обработка на стороне consumer:

[![consumer.png](https://i.postimg.cc/C509XK8w/consumer.png)](https://postimg.cc/R6PPn4GY)

### Логирование

Все события логируются как в консоль, так и в файл **app.log**. Лог содержит информацию о:
  - Обрабатываемых страницах (название - содержимое тега <title>, ссылка)
  - Найденных ссылках (название - содержимое тега <a>, ссылка)
  - Отправке новых ссылок в очередь
  - Ошибках при обработке страниц

Также все обработанные ссылки хранятся в создающемся файле **processed_links.txt**.
